<!DOCTYPE html>
<meta charset='utf-8'>
<html>
  <head>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<link rel="stylesheet" type="text/css" href='table.css'/>
	 <script type='text/javascript'>
	 
	 var tabulate = function (data,columns) {
	   d3.select("body").append("div")
			.attr("id","container");
	   
	   d3.select("#container").append("div")
			.attr("id", "FilterableTable");
			
	   d3.select("#FilterableTable").append("div")
			.attr("class", "SearchBar")
			
	  d3.select(".SearchBar")
		.append("input")
		.attr("class", "SearchBar")
		.attr("id", "searchsub")
		.attr("type", "text")
		.attr("placeholder", "Search Subjects...");		
	
      d3.select(".SearchBar")
		.append("input")
		.attr("class", "SearchBar")
		.attr("id", "searchuid")
		.attr("type", "text")
		.attr("placeholder", "Search UID...");	
	
	   var table = d3.select('#FilterableTable').append('table').attr("id","d3table")
	   var thead = table.append('thead')
	   var tbody = table.append('tbody')

		thead.append('tr')
			.selectAll('th')
			.data(columns)
			.enter()
			.append('th')
			.text(function (d) { return d })

	  var rows = tbody.selectAll('tr')
	    .data(data)
	    .enter()
		.append('tr')
	  //console.log(rows)	
	  var cells = rows.selectAll('td')
	    .data(function(row) {
	    	return columns.map(function (column) {
	    		return { column: column, value: row[column] }
			})
		})
		.enter()
		.append('td')
		.text(function (d) { return d.value })
     //console.log(cells)	
	//return table;
	
	}

	d3.csv('nlb_short_story.csv',function (data) {
		//data.forEach(function(d){ d.date = parseDate(d.date)
		//})
		var columns = ['uid','book','title','subject','summary','original_publisher','digital_publisher','format','language','copyright','author_name','published']
		var d3table = tabulate(data,columns)
		//https://bost.ocks.org/mike/constancy/
		d3.select("#searchsub")
			.on("keyup",function(){
				subtext = d3.select('#searchsub').node().value.trim();
				uidtext = d3.select('#searchuid').node().value.trim();
				var subregex = new RegExp("^.*" + subtext + ".*", "i");
				var uidregex = new RegExp("^.*" + uidtext + ".*", "i");
				//console.log(subtext);
				//console.log(uidtext);
				
				searched_data = data.filter(function(p) {
					return (subregex.test(p.subject)) && (uidregex.test(p.uid))
				})
				
						
				var frows = d3.select('#d3table').select("tbody").selectAll("tr")
						.data(searched_data)
				frows.enter()
				     .append("tr")	
				
				cells = frows.selectAll('td')
								cells.data(function(row) {
									return columns.map(function (column) {
										return { column: column, value: row[column]}
									})
								})
					        //.enter()            Not Required. If it sees the same number of rows left, it will not do anything. 
							//.append('td')
							.text(function (d) { return d.value })
					 
					 
				
				//console.log(cells);
				frows.exit().remove();

			});
		
		d3.select("#searchuid")
			.on("keyup",function(){
				subtext = d3.select('#searchsub').node().value.trim();
				uidtext = d3.select('#searchuid').node().value.trim();
				var subregex = new RegExp("^.*" + subtext + ".*", "i");
				var uidregex = new RegExp("^.*" + uidtext + ".*", "i");
				//console.log(subtext);
				//console.log(uidtext);
				
				searched_data = data.filter(function(p) {
					return (subregex.test(p.subject)) && (uidregex.test(p.uid))
				})
				var frows = d3.select('#d3table').select("tbody").selectAll("tr")
						.data(searched_data)
				frows.enter()
				     .append("tr")	
				
				cells = frows.selectAll('td')
								cells.data(function(row) {
									return columns.map(function (column) {
										return { column: column, value: row[column]}
									})
								})
							.text(function (d) { return d.value })
				frows.exit().remove();

			});
		
	});
	
	
	
	
	</script>
  </head>
  <body>
   
   
  </body>
</html>

